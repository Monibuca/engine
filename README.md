# m7s v4æ ¸å¿ƒå¼•æ“

è¯¥é¡¹ç›®ä¸ºm7sçš„å¼•æ“éƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†é€»è¾‘æ˜¯æµåª’ä½“æœåŠ¡å™¨çš„æ ¸å¿ƒè½¬å‘é€»è¾‘ã€‚åŒ…å«äº†ä¸€ä¸ªæ’ä»¶çš„å¼•å…¥æœºåˆ¶ï¼Œå…¶ä»–åŠŸèƒ½å‡ç”±æ’ä»¶å®ç°

# å¼•æ“çš„åŸºæœ¬åŠŸèƒ½
- æä¾›æ’ä»¶æœºåˆ¶ï¼Œå¯¹æ’ä»¶çš„å¯åŠ¨ï¼Œé…ç½®è§£æï¼Œäº‹ä»¶æ´¾å‘ç­‰è¿›è¡Œç»Ÿä¸€ç®¡ç†
- æä¾›H264ã€H265ã€AACã€G711æ ¼å¼çš„è½¬å‘
- æä¾›å¯å¤ç”¨çš„AVCCæ ¼å¼ã€RTPæ ¼å¼ã€AnnexBæ ¼å¼ã€ADTSæ ¼å¼ç­‰é¢„å°è£…æœºåˆ¶
- æä¾›å¤šTrackæœºåˆ¶ï¼Œæ”¯æŒå¤§å°æµï¼ŒåŠ å¯†æµæ‰©å±•
- æä¾›DataTrackæœºåˆ¶ï¼Œå¯ç”¨äºå®ç°æˆ¿é—´æ–‡å­—èŠå¤©ç­‰åŠŸèƒ½
- æä¾›æ—¶é—´æˆ³åŒæ­¥æœºåˆ¶ï¼Œé™é€Ÿæœºåˆ¶
- æä¾›RTPåŒ…ä¹±åºé‡æ’æœºåˆ¶
- æä¾›è®¢é˜…è€…è¿½å¸§è·³å¸§æœºåˆ¶
- æä¾›å‘å¸ƒè®¢é˜…å¯¹å¤–æ¨æ‹‰çš„åŸºç¡€æ¶æ„
- æä¾›é‰´æƒæœºåˆ¶çš„åº•å±‚æ¶æ„æ”¯æŒ
- æä¾›å†…å­˜å¤ç”¨æœºåˆ¶
- æä¾›å‘å¸ƒè€…æ–­çº¿é‡è¿æœºåˆ¶
- æä¾›æŒ‰éœ€æ‹‰æµæœºåˆ¶
- æä¾›HTTPæœåŠ¡ç«¯å£å…¬ç”¨æœºåˆ¶
- æä¾›HTTP APIæ¥å£è‡ªåŠ¨æ³¨å†Œæœºåˆ¶
- æä¾›HTTPæ¥å£ä¸­é—´ä»¶æœºåˆ¶
- æä¾›ç»“æ„åŒ–æ—¥å¿—
- æä¾›æµä¿¡æ¯ç»Ÿè®¡å’Œè¾“å‡º
- æä¾›äº‹ä»¶æ€»çº¿æœºåˆ¶ï¼Œå¯ä»¥å¯¹æ‰€æœ‰æ’ä»¶å¹¿æ’­äº‹ä»¶
- æä¾›é…ç½®çƒ­æ›´æ–°æœºåˆ¶
## å¼•æ“è‡ªå¸¦HTTPæ¥å£
- è·å–æŸä¸€ä¸ªæµçš„è¯¦æƒ… `/api/stream?streamPath=xxx`
- ç»ˆæ­¢æŸä¸€ä¸ªæµ `/api/closestream?streamPath=xxx`
- è·å–engineä¿¡æ¯ `/api/sysInfo` è¿”å›å€¼{Version:xxx,StartTime:xxx,IP:[xxx.xxx.xxx.xxx]}
- è·å–ç³»ç»ŸåŸºæœ¬æƒ…å†µ `/api/summary` è¿”å›å€¼Summaryæ•°æ®
- è·å–æ‰€æœ‰æ’ä»¶ä¿¡æ¯ `/api/plugins` è¿”å›å€¼Pluginæ•°æ®
- è¯»å–mp4æ–‡ä»¶å†æ¬¡å‘å¸ƒä¸ºè§†é¢‘æµ `/api/replay/mp4?streamPath=xxx&dump=filepath`  filepathæ˜¯æ–‡ä»¶è·¯å¾„
- è¯»å–tsæ–‡ä»¶å†æ¬¡å‘å¸ƒä¸ºè§†é¢‘æµ `/api/replay/ts?streamPath=xxx&dump=filepath`  filepathæ˜¯æ–‡ä»¶è·¯å¾„
- è·å–æŒ‡å®šçš„é…ç½®ä¿¡æ¯ `/api/getconfig?name=xxx` è¿”å›xxxæ’ä»¶çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æœä¸å¸¦å‚æ•°æˆ–å‚æ•°ä¸ºç©ºåˆ™è¿”å›å…¨å±€é…ç½®
- ä¿®æ”¹å¹¶ä¿å­˜é…ç½®ä¿¡æ¯ `/api/modifyconfig?name=xxx&yaml=1` ä¿®æ”¹xxxæ’ä»¶çš„é…ç½®ä¿¡æ¯,åœ¨è¯·æ±‚çš„bodyä¸­ä¼ å…¥ä¿®æ”¹åçš„é…ç½®yamlå­—ç¬¦ä¸²
- çƒ­æ›´æ–°é…ç½®ä¿¡æ¯ `/api/updateconfig?name=xxx` çƒ­æ›´æ–°xxxæ’ä»¶çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æœä¸å¸¦å‚æ•°æˆ–å‚æ•°ä¸ºç©ºåˆ™çƒ­æ›´æ–°å…¨å±€é…ç½®
- è·å–æ‰€æœ‰è¿œç«¯æ‹‰æµä¿¡æ¯ `/api/list/pull` è¿”å›{RemoteURL:"",StreamPath:"",Type:"",StartTime:""}
- è·å–æ‰€æœ‰å‘è¿œç«¯æ¨æµä¿¡æ¯ `/api/list/push` è¿”å›{RemoteURL:"",StreamPath:"",Type:"",StartTime:""}
- åœæ­¢æ¨æµ `/api/stop/push?url=xxx` åœæ­¢å‘xxxæ¨æµ ï¼ŒæˆåŠŸè¿”å›ok
- åœæ­¢æŸä¸ªè®¢é˜…è€… `/api/stop/subscribe?streamPath=xxx&id=xxx` åœæ­¢xxxæµçš„xxxè®¢é˜…è€… ï¼ŒæˆåŠŸè¿”å›ok
# å¼•æ“é»˜è®¤é…ç½®
```yaml
global:
  disableall: false # æ˜¯å¦ç¦ç”¨æ‰€æœ‰æ’ä»¶
  loglang: zh # æ—¥å¿—è¯­è¨€ï¼Œå¯é€‰å€¼ï¼šzh,en
  loglevel: info # æ—¥å¿—çº§åˆ«ï¼Œå¯é€‰å€¼ï¼šdebug,info,warn,error,panic,fatal
  http:
    listenaddr: :8080 # ç½‘å…³åœ°å€ï¼Œç”¨äºè®¿é—®API
    listenaddrtls: :8443  # ç”¨äºHTTPSæ–¹å¼è®¿é—®APIçš„ç«¯å£é…ç½®
    certfile: ""
    keyfile: ""
    cors: true  # æ˜¯å¦è‡ªåŠ¨æ·»åŠ corså¤´
    username: ""  # ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äºAPIè®¿é—®æ—¶çš„åŸºæœ¬èº«ä»½è®¤è¯
    password: ""
    readtimeout: 0 # è¯»å–è¶…æ—¶æ—¶é—´ï¼Œ0ä¸ºä¸é™åˆ¶
    writetimeout: 0 # å†™å…¥è¶…æ—¶æ—¶é—´ï¼Œ0ä¸ºä¸é™åˆ¶
    idletimeout: 0 # ç©ºé—²è¶…æ—¶æ—¶é—´ï¼Œ0ä¸ºä¸é™åˆ¶
  publish:
      pubaudio: true # æ˜¯å¦å‘å¸ƒéŸ³é¢‘æµ
      pubvideo: true # æ˜¯å¦å‘å¸ƒè§†é¢‘æµ
      kickexist: false # å‰”å‡ºå·²ç»å­˜åœ¨çš„å‘å¸ƒè€…ï¼Œç”¨äºé¡¶æ›¿åŸæœ‰å‘å¸ƒè€…
      publishtimeout: 10s # å‘å¸ƒæµé»˜è®¤è¿‡æœŸæ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´å‘å¸ƒè€…æ²¡æœ‰æ¢å¤æµå°†è¢«åˆ é™¤
      delayclosetimeout: 0 # è‡ªåŠ¨å…³é—­è§¦å‘åå»¶è¿Ÿçš„æ—¶é—´(æœŸé—´å†…å¦‚æœæœ‰æ–°çš„è®¢é˜…åˆ™å–æ¶ˆè§¦å‘å…³é—­)ï¼Œ0ä¸ºå…³é—­è¯¥åŠŸèƒ½ï¼Œä¿æŒè¿æ¥ã€‚
      waitclosetimeout: 0 # å‘å¸ƒè€…æ–­å¼€åç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´å‘å¸ƒè€…æ²¡æœ‰æ¢å¤æµå°†è¢«åˆ é™¤ï¼Œ0ä¸ºå…³é—­è¯¥åŠŸèƒ½ï¼Œç”±è®¢é˜…è€…å†³å®šæ˜¯å¦åˆ é™¤
      buffertime: 0 # ç¼“å­˜æ—¶é—´ï¼Œç”¨äºæ—¶å…‰å›æº¯ï¼Œ0ä¸ºå…³é—­ç¼“å­˜
      idletimeout: 0 # ç©ºé—²è¶…æ—¶æ—¶é—´ï¼Œ0ä¸ºä¸é™åˆ¶
      speedlimit: 500ms # é™é€Ÿè¶…æ—¶æ—¶é—´ 0ä¸ºä¸é™é€Ÿï¼Œå¯¹äºè¯»å–æ–‡ä»¶è¿™ç±»æµéœ€è¦é™é€Ÿï¼Œå¦åˆ™è¯»å–è¿‡å¿«ï¼ˆå¦‚æœæµçš„æ—¶é—´æˆ³ä¸æ­£ç¡®ï¼Œåˆ™åªèƒ½å…³é—­è¯¥åŠŸèƒ½ï¼šè®¾ç½®ä¸º0ï¼‰
      key:                      # å‘å¸ƒé‰´æƒkey
	    secretargname: secret     # å‘å¸ƒé‰´æƒå‚æ•°å
	    expireargname:   expire   # å‘å¸ƒé‰´æƒå¤±æ•ˆæ—¶é—´å‚æ•°å
  subscribe:
      subaudio: true # æ˜¯å¦è®¢é˜…éŸ³é¢‘æµ
      subvideo: true # æ˜¯å¦è®¢é˜…è§†é¢‘æµ
      subaudioargname: ats # è®¢é˜…éŸ³é¢‘è½¨é“å‚æ•°å
      subvideoargname: vts # è®¢é˜…è§†é¢‘è½¨é“å‚æ•°å
      subdataargname: dts # è®¢é˜…æ•°æ®è½¨é“å‚æ•°å
      subaudiotracks: [] # è®¢é˜…éŸ³é¢‘è½¨é“åç§°åˆ—è¡¨
      subvideotracks: [] # è®¢é˜…è§†é¢‘è½¨é“åç§°åˆ—è¡¨
      submode: 0 # è®¢é˜…æ¨¡å¼ï¼Œ0ä¸ºè·³å¸§è¿½èµ¶æ¨¡å¼ï¼Œ1ä¸ºä¸è¿½èµ¶ï¼ˆå¤šç”¨äºå½•åˆ¶ï¼‰ï¼Œ2ä¸ºæ—¶å…‰å›æº¯æ¨¡å¼
      syncmode: 0 # éŸ³è§†é¢‘åŒæ­¥æ¨¡å¼ï¼Œ0æŒ‰ç…§æ—¶é—´æˆ³åŒæ­¥ï¼Œ1æŒ‰ç…§å†™å…¥æ—¶é—´åŒæ­¥ï¼ˆåœ¨æ—¶é—´æˆ³ä¸æ­£ç¡®çš„æ—¶å€™)
      iframeonly: false # åªè®¢é˜…å…³é”®å¸§
      waittimeout: 10s # ç­‰å¾…å‘å¸ƒè€…çš„è¶…æ—¶æ—¶é—´ï¼Œç”¨äºè®¢é˜…å°šæœªå‘å¸ƒçš„æµ
      writebuffersize: 0 # è®¢é˜…è€…å†™ç¼“å­˜å¤§å°ï¼Œç”¨äºå‡å°‘ioæ¬¡æ•°ï¼Œä½†å¯èƒ½å½±å“å®æ—¶æ€§
      key:                      # è®¢é˜…é‰´æƒkey
	    secretargname: secret     # è®¢é˜…é‰´æƒå‚æ•°å
	    expireargname:   expire   # è®¢é˜…é‰´æƒå¤±æ•ˆæ—¶é—´å‚æ•°å
      internal: false # æ˜¯å¦å†…éƒ¨è®¢é˜…ï¼Œå†…éƒ¨è®¢é˜…ä¸ä¼šè§¦å‘å‘å¸ƒè€…è‡ªåŠ¨æ–­å¼€åŠŸèƒ½
  enableavcc : true  # å¯ç”¨AVCCæ ¼å¼ç¼“å­˜ï¼Œç”¨äºrtmpåè®®
  enablertp : true # å¯ç”¨rtpæ ¼å¼ç¼“å­˜ï¼Œç”¨äºrtspã€websocketã€gb28181åè®®
  enableauth: true # å¯ç”¨é‰´æƒ,è¯¦ç»†æŸ¥çœ‹é‰´æƒæœºåˆ¶
  enablesubevent: true # å¯ç”¨è®¢é˜…äº‹ä»¶ï¼Œç”¨äºè®¢é˜…è€…ä¸Šä¸‹çº¿äº‹ä»¶,å…³é—­å¯ä»¥æé«˜æ€§èƒ½
  rtpreoderbufferlen: 50 # rtpä¹±åºé‡æ’ç¼“å­˜é•¿åº¦
  eventbussize: 10 # äº‹ä»¶æ€»çº¿ç¼“å­˜å¤§å°ï¼Œäº‹ä»¶è¾ƒå¤šæ—¶å®¹æ˜“å µé˜»å¡çº¿ç¨‹ï¼Œéœ€è¦å¢å¤§ç¼“å­˜
  poolsize: 0 # å†…å­˜æ± å¤§å°ï¼Œ0ä¸ºä¸ä½¿ç”¨å†…å­˜æ± 
  pulseinterval: 5s # å¿ƒè·³äº‹ä»¶é—´éš”æ—¶é—´
  console: 
    server : console.monibuca.com:44944 # è¿æ¥è¿œç¨‹æ§åˆ¶å°çš„åœ°å€
    secret: "" # è¿œç¨‹æ§åˆ¶å°çš„ç§˜é’¥
    publicaddr: "" # å®ä¾‹å…¬ç½‘åœ°å€ï¼Œæä¾›è¿œç¨‹æ§åˆ¶å°è®¿é—®çš„åœ°å€ï¼Œä¸é…ç½®çš„è¯ä½¿ç”¨è‡ªåŠ¨è¯†åˆ«çš„åœ°å€
    publicaddrtls: "" # å®ä¾‹å…¬ç½‘åœ°å€ï¼Œæä¾›è¿œç¨‹æ§åˆ¶å°è®¿é—®çš„åœ°å€ï¼Œä¸é…ç½®çš„è¯ä½¿ç”¨è‡ªåŠ¨è¯†åˆ«çš„åœ°å€ï¼ˆhttpsï¼‰
```

# é…ç½®è¦†ç›–æœºåˆ¶
- å¦‚æœä¸å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œè¯¥é…ç½®å€¼ä¸ºä»£ç ä¸­å†™æ­»çš„é…ç½®å€¼
- å¦‚æœå­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å€¼è¦†ç›–é»˜è®¤å€¼
- httpã€publishã€subscribeä¸‰ä¸ªé…ç½®éµå¾ªä¼˜å…ˆçº§é¡ºåº
1. å¦‚æœå‘å¸ƒæµæˆ–è€…è®¢é˜…æµä¸­åŒ…å«å¯¹åº”çš„å‚æ•°ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨
2. å…¶æ¬¡ï¼ŒæŸ¥æ‰¾å¯¹åº”æ’ä»¶çš„é…ç½®é¡¹ä¸­æ˜¯å¦åŒ…å«é…ç½®é¡¹
3. æœ€åï¼Œä½¿ç”¨å…¨å±€é…ç½®ä¸­çš„é…ç½®

# æµçš„çŠ¶æ€å›¾
```mermaid
stateDiagram-v2
    [*] --> âŒ›ç­‰å¾…å‘å¸ƒè€… : åˆ›å»º
    âŒ›ç­‰å¾…å‘å¸ƒè€… --> ğŸŸ¢æ­£åœ¨å‘å¸ƒ :å‘å¸ƒ
    âŒ›ç­‰å¾…å‘å¸ƒè€… --> ğŸ”´å·²å…³é—­ :å…³é—­
    âŒ›ç­‰å¾…å‘å¸ƒè€… --> ğŸ”´å·²å…³é—­  :è¶…æ—¶
    âŒ›ç­‰å¾…å‘å¸ƒè€… --> ğŸ”´å·²å…³é—­  :æœ€åè®¢é˜…è€…ç¦»å¼€
    ğŸŸ¢æ­£åœ¨å‘å¸ƒ --> âŒ›ç­‰å¾…å‘å¸ƒè€…: å‘å¸ƒè€…æ–­å¼€
    ğŸŸ¢æ­£åœ¨å‘å¸ƒ --> ğŸŸ¡ç­‰å¾…å…³é—­: æœ€åè®¢é˜…è€…ç¦»å¼€
    ğŸŸ¢æ­£åœ¨å‘å¸ƒ --> ğŸ”´å·²å…³é—­  :å…³é—­
    ğŸŸ¡ç­‰å¾…å…³é—­ --> ğŸŸ¢æ­£åœ¨å‘å¸ƒ :ç¬¬ä¸€ä¸ªè®¢é˜…è€…è¿›å…¥
    ğŸŸ¡ç­‰å¾…å…³é—­ --> ğŸ”´å·²å…³é—­  :å…³é—­
    ğŸŸ¡ç­‰å¾…å…³é—­ --> ğŸ”´å·²å…³é—­  :è¶…æ—¶
    ğŸŸ¡ç­‰å¾…å…³é—­ --> ğŸ”´å·²å…³é—­  :å‘å¸ƒè€…æ–­å¼€
```

# é‰´æƒæœºåˆ¶
## é»˜è®¤é‰´æƒ

åœ¨publish å’Œ subscribe ä¸­é…ç½® key å¼•æ“ä¼šè‡ªåŠ¨è¿›è¡Œé‰´æƒ,
æ¨æµæˆ–è€…æ‹‰æµæ—¶éœ€è¦åœ¨urlä¸­æ·»åŠ å‚æ•° secret=xxx&expire=xxxã€‚

- secretä¸ºé‰´æƒå‰é¢ï¼ŒMD5(key+StreamPath+expire)
- expireä¸ºé‰´æƒå¤±æ•ˆæ—¶é—´ï¼Œæ ¼å¼æ˜¯åå…­è¿›åˆ¶ UNIX æ—¶é—´æˆ³

### æ—¶é—´æˆ³è®¡ç®—
```
è®¾ç½®æ—¶é—´ï¼š2018.12.01 08:30:00
åè¿›åˆ¶ UNIX æ—¶é—´æˆ³ï¼š1543624200
åå…­è¿›åˆ¶ UNIX æ—¶é—´æˆ³ï¼š5C01D608ï¼ˆäº‘ç›´æ’­é‰´æƒé…ç½®ä½¿ç”¨åå…­è¿›åˆ¶ UNIX æ—¶é—´æˆ³ï¼Œåå…­è¿›åˆ¶ä¸åŒºåˆ†å­—æ¯å¤§å°å†™ï¼‰
```
### é‰´æƒç­¾åè®¡ç®—
```
secret = MD5(key+StreamPath+expire) 
secret = MD5(ngoeiq03+test/01+5C01D608)
secret = MD5(ngoeiq03test/015C01D608)
secret = ce797dc6238156d548ef945e6ad1ea20
```

## å•ç‹¬é‰´æƒ

å¦‚æœéœ€è¦è‡ªå®šä¹‰é‰´æƒï¼Œå¯ä»¥åœ¨æ’ä»¶ä¸­å®ç°é‰´æƒæ¥å£ï¼Œ
å¼•æ“ä¸­å®šä¹‰å¦‚ä¸‹ä¸¤ä¸ªæ¥å£ï¼Œæ’ä»¶ä¸­çš„å‘å¸ƒè€…æˆ–è€…è®¢é˜…è€…å¯ä»¥å®ç°è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¼•æ“ä¼šåœ¨å‘å¸ƒæˆ–è€…è®¢é˜…æ—¶è°ƒç”¨è¿™ä¸¤ä¸ªæ¥å£è¿›è¡Œé‰´æƒ
```go
type AuthSub interface {
	OnAuth(*util.Promise[ISubscriber]) error
}

type AuthPub interface {
	OnAuth(*util.Promise[IPublisher]) error
}
```
- OnAuthè¿”å›é”™è¯¯å³é‰´æƒå¤±è´¥
- Promiseæ–¹ä¾¿å¼‚æ­¥é‰´æƒï¼Œå¯ä»¥åç»­è°ƒç”¨å…¶Resolveæˆ–Rejectæ–¹æ³•è¿›è¡Œé‰´æƒç»“æœçš„è¿”å›

## å…¨å±€é‰´æƒ

è‡ªå®šä¹‰é‰´æƒä¹Ÿå¯ä»¥å…¨å±€ç”Ÿæ•ˆï¼Œ
å¼•æ“ä¸­å®šä¹‰å¦‚ä¸‹ä¸¤ä¸ªå…¨å±€å‡½æ•°çš„å˜é‡ï¼Œæ’ä»¶ä¸­å¯ä»¥å¯¹è¿™ä¸¤ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼ï¼Œå¼•æ“ä¼šåœ¨å‘å¸ƒæˆ–è€…è®¢é˜…æ—¶è°ƒç”¨è¿™ä¸¤ä¸ªæ¥å£è¿›è¡Œé‰´æƒ
```go
var OnAuthSub func(p *util.Promise[ISubscriber]) error
var OnAuthPub func(p *util.Promise[IPublisher]) error
```
** æ³¨æ„ï¼šå¦‚æœå•ç‹¬é‰´æƒå’Œå…¨å±€é‰´æƒåŒæ—¶å­˜åœ¨ï¼Œä¼˜å…ˆä½¿ç”¨å•ç‹¬é‰´æƒ **
** å…¨å±€é‰´æƒå‡½æ•°å¯ä»¥è¢«å¤šæ¬¡è¦†ç›–ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±å®ç°é‰´æƒé€»è¾‘çš„åˆå¹¶ **

# Httpä¸­é—´ä»¶
åœ¨HTTPConfigæ¥å£ä¸­å¢åŠ äº†AddMiddlewareæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–¹æ³•æ·»åŠ ä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶çš„å®šä¹‰å¦‚ä¸‹
```go
type Middleware func(string, http.Handler) http.Handler
type HTTPConfig interface {
	GetHTTPConfig() *HTTP
	Listen(ctx context.Context) error
	Handle(string, http.Handler)
	AddMiddleware(Middleware)
}

```
ä¸­é—´ä»¶çš„æ·»åŠ å¿…é¡»åœ¨FirstConfigä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯åœ¨Listenä¹‹å‰
ä¾‹å¦‚ï¼š
```go
type MyMiddlewareConfig struct {
  	config.HTTP
}
var myMiddlewareConfig = &MyMiddlewareConfig{}
func init(){
  myMiddlewareConfig.AddMiddleware(func(pattern string, handler http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
      // do something
      handler.ServeHTTP(w, r)
    })
  })
}
```